#!/usr/bin/env python
import os,shutil
import subprocess
import os.path
from subprocess import check_call
from pyfiglet import Figlet
from termcolor import colored
from simple_colors import *
import psycopg2
import datetime
from database import *
from installation import *
from scanner import *
  

def banner():
     print("""\033[1;32m
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                          █████████  ████                          █████     █████████                                                             
                          ███░░░░░███░░███                         ░░███     ███░░░░░███                                                            
                         ███     ░░░  ░███   ██████  █████ ████  ███████    ░███    ░░░   ██████   ██████   ████████   ████████    ██████  ████████ 
                        ░███          ░███  ███░░███░░███ ░███  ███░░███    ░░█████████  ███░░███ ░░░░░███ ░░███░░███ ░░███░░███  ███░░███░░███░░███
                        ░███          ░███ ░███ ░███ ░███ ░███ ░███ ░███     ░░░░░░░░███░███ ░░░   ███████  ░███ ░███  ░███ ░███ ░███████  ░███ ░░░ 
                        ░░███     ███ ░███ ░███ ░███ ░███ ░███ ░███ ░███     ███    ░███░███  ███ ███░░███  ░███ ░███  ░███ ░███ ░███░░░   ░███     
                         ░░█████████  █████░░██████  ░░████████░░████████   ░░█████████ ░░██████ ░░████████ ████ █████ ████ █████░░██████  █████    
                          ░░░░░░░░░  ░░░░░  ░░░░░░    ░░░░░░░░  ░░░░░░░░     ░░░░░░░░░   ░░░░░░   ░░░░░░░░ ░░░░ ░░░░░ ░░░░ ░░░░░  ░░░░░░  ░░░░░     
                                                                                                                                                    Coded By Jagadeesh Ram Ch
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                                  Note: Please give numerical numbers for selection
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
""")
    

def dem(path):
    #print(path)
    print("""
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
									Choose Your Option
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
									(1) Install Tools
									(2) Scanning
									(3) Data Base Reports
									(4) Exit
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
""")


                    



while True:
   
    banner()
    print("\n ")
    path=os.getcwd()
    dem(path)
    a=int(input(blue("Select your option : ","bold")))
    if a==1:
        
        print ("\n")
        print ("""
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
									  Select Your Machine
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
										(1) Ubuntu/Debian                               
										(2) CentOS 8
										(3) Exit
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------""")
        b=int(input(red("Select Machine:","bold")))
        if  b==1:
            ubuntu()
        if  b==2:
            centos()
        
        if  b==3:
            exit()
    if a==2:
        os.chdir(path)
        os.system(" sudo systemctl start docker")
        #print(path)
        print(""" 
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                                                    Tools
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                                                (1) Trivy
                                                                                (2) Clair
                                                                                (3) Grype-Anchore
                                                                                (4) Combined Tools
                                                                                (5) Database Reports
                                                                                (6) Exit
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                                        Note:  The reports are stored in text file with tool name as file_name,but for combined tools it was stored in reports folder
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
""")
        e=int(input(red("Select Tool to scan:","bold")))
        if e==1:
            trivy(path)
        if e==2:
            clair(path)
        if e==3:
            grype(path)
        if e==4:
            combine(path)
        if e==5:
            #print(path)
            retrive(path)
        if e==6:
            exit()
    if  a==3:
         #print(path)
         retrive(path)
        
    if a==4:
        exit()
